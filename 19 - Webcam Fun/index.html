<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Get User Media Code Along!</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="https://fav.farm/ğŸ”¥" />
  </head>
  <body>
    <div class="photobooth">
      <div class="controls">
        <button onClick="takePhoto()">Take Photo</button>
        <!-- <div class="rgb">
          <label for="rmin">Red Min:</label>
          <input type="range" min="0" max="255" name="rmin" />
          <label for="rmax">Red Max:</label>
          <input type="range" min="0" max="255" name="rmax" />

          <br />

          <label for="gmin">Green Min:</label>
          <input type="range" min="0" max="255" name="gmin" />
          <label for="gmax">Green Max:</label>
          <input type="range" min="0" max="255" name="gmax" />

          <br />

          <label for="bmin">Blue Min:</label>
          <input type="range" min="0" max="255" name="bmin" />
          <label for="bmax">Blue Max:</label>
          <input type="range" min="0" max="255" name="bmax" />
        </div>
      </div> -->

      <canvas class="photo"></canvas>
      <video class="player"></video>
      <div class="strip"></div>
    </div>

    <audio class="snap" src="./snap.mp3" hidden></audio>

    <!-- <script src="scripts-FINISHED.js"></script> -->
    <script>
      const canvas = document.querySelector("canvas");
      // é¡µé¢åŠ è½½ -> è¯·æ±‚æ‘„åƒå¤´ -> åŒæ„çš„è¯å°±æŠŠæ‘„åƒå¤´è¿”å›çš„å†…å®¹å±•ç¤ºåˆ° photo å’Œ playerï¼ˆé•œå¤´ï¼‰
      const constraints = { audio: true, video: true };
      navigator.mediaDevices
        // è¯·æ±‚æ‘„åƒå¤´
        .getUserMedia(constraints)
        //åŒæ„çš„è¯å°±æŠŠæ‘„åƒå¤´è¿”å›çš„å†…å®¹å±•ç¤ºåˆ° player
        .then(function (showCamera) {
          const video = document.querySelector("video");
          video.srcObject = showCamera;
          video.onloadedmetadata = function (e) {
            video.play();
          };

          // æ·»åŠ åˆ°photo
          const ctx = canvas.getContext("2d");
          function drawToCanvas() {
            [canvas.width, canvas.height] = [
              video.videoWidth,
              video.videoHeight,
            ];
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            requestAnimationFrame(drawToCanvas);
          }
          drawToCanvas();
        })
        .catch(function (error) {
          console.log(err.name + ":" + err.message);
        });

      // ç‚¹å‡»take photo -> æ’­æ”¾snap + ä¿å­˜ç‚¹å‡»è¿™ä¸€ç§’çš„ç…§ç‰‡ -> ç…§ç‰‡æ·»åŠ åˆ°stripä¸‹ï¼ˆaæ ‡ç­¾å†…imgï¼‰
      const SnapAudio = document.querySelector("audio")
      const takePhotoButton = document.querySelector("button")
      const photoStrip = document.querySelector(".strip")

      function takePhoto(){
        // æ’­æ”¾snap
        SnapAudio.currentTime = 0;
        SnapAudio.play();
        
        // ä¿å­˜ç‚¹å‡»è¿™ä¸€ç§’çš„ç…§ç‰‡
        const data = canvas.toDataURL('image/png');
        
        const downloadLink = document.createElement('a')
        downloadLink.href = data;
        downloadLink.download = 'canvas.png'
        downloadLink.innerHTML = `<img src="${data}" alt="canvas" />`
        photoStrip.insertBefore(downloadLink,photoStrip.firstChild)
      }
      // ç‚¹å‡»ç…§ç‰‡ å¼¹å‡ºä¿å­˜çª—å£
    </script>
  </body>
</html>
