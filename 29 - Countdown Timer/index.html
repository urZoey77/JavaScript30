<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Countdown Timer</title>
    <link
      href="https://fonts.googleapis.com/css?family=Inconsolata"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="https://fav.farm/ðŸ”¥" />
  </head>
  <body>
    <div class="timer">
      <div class="timer__controls">
        <button data-time="20" class="timer__button">20 Secs</button>
        <button data-time="300" class="timer__button">Work 5</button>
        <button data-time="900" class="timer__button">Quick 15</button>
        <button data-time="1200" class="timer__button">Snack 20</button>
        <button data-time="3600" class="timer__button">Lunch Break</button>
        <form name="customForm" id="custom">
          <input type="text" name="minutes" placeholder="Enter Minutes" />
        </form>
      </div>
      <div class="display">
        <h1 class="display__time-left"></h1>
        <p class="display__end-time"></p>
      </div>
    </div>

    <!-- <script src="scripts-FINISHED.js"></script> -->
    <script>
      let isTimer;
      const controls = document.querySelector(".timer__controls");
      const timeLeft = document.querySelector(".display__time-left");
      const endTime = document.querySelector(".display__end-time");
      const inputTime = document.querySelector(`#custom`);
      console.log(inputTime);

      controls.addEventListener("click", (e) => {
        if (e.target.matches(".timer__button")) {
          const clickTime = new Date();
          console.log(clickTime);

          if (isTimer) {
            clearTimeout(isTimer);
          }
          let time = parseInt(e.target.dataset.time);
          const futureTime = new Date(clickTime.getTime() + time * 1000);
          console.log(futureTime);

          endTime.innerText = `Be Back At ${futureTime.getHours()}:${futureTime.getMinutes()}`;
          timeCal();
          function timeCal() {
            if (time <= 0) {
              clearTimeout(isTimer);
              timeLeft.innerText = "00:00";
              return;
            }

            let minutes = Math.round(time / 60);
            let secs = time % 60;
            timeLeft.innerText = `${String(minutes).padStart(2, "0")}:${String(
              secs
            ).padStart(2, "0")}`;

            time--;
            isTimer = setTimeout(timeCal, 1000);
          }
        }
      });

      inputTime.addEventListener("submit", (e) => {
        event.preventDefault();
        console.log("e in input >>> ", e);
        if (isTimer) {
          clearTimeout(isTimer);
        }
        let time =
          parseInt(document.querySelector(`input[name="minutes"]`).value) * 60;
        console.log("time in submit >>> ", time);
        timeCal();
        function timeCal() {
          if (time <= 0) {
            clearTimeout(isTimer);
            timeLeft.innerText = "00:00";
            return;
          }

          let minutes = Math.round(time / 60);
          let secs = time % 60;
          timeLeft.innerText = `${String(minutes).padStart(2, "0")}:${String(
            secs
          ).padStart(2, "0")}`;
          time--;
          isTimer = setTimeout(timeCal, 1000);
        }
      });
    </script>
  </body>
</html>
