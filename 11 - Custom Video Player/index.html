<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HTML Video Player</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="https://fav.farm/ðŸ”¥" />
  </head>
  <body>
    <div class="player">
      <video class="player__video viewer" src="652333414.mp4"></video>

      <div class="player__controls">
        <div class="progress">
          <div class="progress__filled"></div>
        </div>

        <!-- æ’­æ”¾è§†é¢‘æŒ‰é’® -->
        <button class="player__button toggle" title="Toggle Play">â–º</button>
        <!-- éŸ³é‡æ»‘åŠ¨æ¡ -->
        <input
          type="range"
          name="volume"
          class="player__slider"
          min="0"
          max="1"
          step="0.05"
          value="1"
        />
        <!-- æ’­æ”¾é€Ÿåº¦æ»‘åŠ¨æ¡ -->
        <input
          type="range"
          name="playbackRate"
          class="player__slider"
          min="0.5"
          max="2"
          step="0.1"
          value="1"
        />
        <!-- å¾€å‰è·³10så’Œå¾€åŽè·³25sæŒ‰é’® -->
        <button data-skip="-10" class="player__button">Â« 10s</button>
        <button data-skip="25" class="player__button">25s Â»</button>
      </div>
    </div>

    <!-- <script src="scripts-FINISHED.js"></script> -->
    <script>
      const video = document.querySelector("video");
      console.log(video);
      let videoDuration, defaultProgressLength;
      video.addEventListener("loadedmetadata", () => {
        videoDuration = video.duration;
        defaultProgressLength = progressBar.offsetWidth;
        console.log(videoDuration);
      });

      // 1. å®žçŽ°ç‚¹å‡»æ’­æ”¾è§†é¢‘
      // å½“click player__button çš„æ—¶å€™ï¼Œåœ¨æ’­æ”¾å’Œæš‚åœä¸­åˆ‡æ¢ -> å…ˆåˆ¤æ–­è§†é¢‘çš„çŠ¶æ€
      const playerToggleButton = document.querySelector(
        'button[title="Toggle Play"]'
      );
      document.addEventListener("click", (e) => {
        if (e.target === video || e.target === playerToggleButton) {
          if (video.paused) {
            video.play();
            playerToggleButton.innerText = "âš âš";
          } else {
            video.pause();
            playerToggleButton.innerText = "â–º";
          }
        }
      });

      // 2. å®žçŽ°ç‚¹å‡»å¾€å‰è·³10så’Œå¾€åŽè·³25s
      const reduce10s = document.querySelector('button[data-skip="-10"]');
      const add25s = document.querySelector('button[data-skip="25"]');

      document.addEventListener("click", (e) => {
        if (e.target === reduce10s || e.target === add25s) {
          video.currentTime =
            video.currentTime + parseFloat(e.target.dataset.skip);
        }
      });

      // 3. æŽ§åˆ¶éŸ³é‡
      const volumeSilder = document.querySelector('input[name="volume"]');
      volumeSilder.addEventListener("input", () => {
        video.volume = volumeSilder.value;
      });

      // 4. æŽ§åˆ¶æ’­æ”¾é€Ÿåº¦
      const playbackRateSilder = document.querySelector(
        'input[name="playbackRate"]'
      );
      playbackRateSilder.addEventListener("input", () => {
        video.playbackRate = playbackRateSilder.value;
      });

      //5. æ’­æ”¾è¿›åº¦æ¡ - æ ¹æ®å½“å‰æ’­æ”¾æ—¶é•¿å±•ç¤º / é€šè¿‡å•å‡»æˆ–æ‹–æ‹½æ”¹å˜è¿›åº¦
      //  æ ¹æ®å½“å‰æ’­æ”¾æ—¶é•¿å±•ç¤º
      const progressBar = document.querySelector(".progress__filled");
      let clickPosition;
      video.addEventListener("timeupdate", () => {
        const playPercent = (video.currentTime / videoDuration) * 100;
        progressBar.style.width = `${playPercent}%`;
      });

      //  å•å‡»ï¼šæ‹–åŠ¨æ¡åˆ°é¼ æ ‡çš„ä½ç½®ï¼Œè§†é¢‘è¿›åº¦
      function handleProgress(e) {
        clickPosition = e.offsetX / defaultProgressLength;
        progressBar.style.width = `${clickPosition * 100}%`;
        video.currentTime = parseFloat(clickPosition * defaultProgressLength);
      }
      const progressControl = document.querySelector(".player__controls");
      progressControl.addEventListener("click", handleProgress);

      //  æ‹–åŠ¨ï¼šæ‹–åŠ¨æ¡åˆ°é¼ æ ‡çš„ä½ç½®ï¼Œè§†é¢‘è¿›åº¦
      progressControl.addEventListener("mousedown", (e) => {
        document.addEventListener("mousemove", handleProgress);
        document.addEventListener("mouseup", (e) => {
          document.removeEventListener("mousemove", handleProgress);
        });
      });
    </script>
  </body>
</html>
